[[_dg_building-isis]]
= Building Apache Isis
:notice: licensed to the apache software foundation (asf) under one or more contributor license agreements. see the notice file distributed with this work for additional information regarding copyright ownership. the asf licenses this file to you under the apache license, version 2.0 (the "license"); you may not use this file except in compliance with the license. you may obtain a copy of the license at. http://www.apache.org/licenses/license-2.0 . unless required by applicable law or agreed to in writing, software distributed under the license is distributed on an "as is" basis, without warranties or  conditions of any kind, either express or implied. see the license for the specific language governing permissions and limitations under the license.
:_basedir: ../
:_imagesdir: images/
:toc: right




[[_dg_building-isis_git]]
== Git

The Apache Isis source code lives in a git repo.


[[_dg_building-isis_git_installation]]
=== Installation

The easiest place to get hold of command-line git is probably the http://git-scm.com/downloads[github download page].

On Windows, this also installs the rather good mSysGit Unix shell. We recommend that you enable git for both the mSysgit and the Windows command prompt:

image::{_imagesdir}building-isis/setting-up-git.png[width="350px",link="{_imagesdir}building-isis/setting-up-git.png"]

Once git is installed, the two main command line tools to note are:

* `git` command line tool
* `gitk` for viewing the commit history

If using Windows, note that github also have a dedicated https://help.github.com/articles/set-up-git[Windows client]. With a little http://haacked.com/archive/2012/05/30/using-github-for-windows-with-non-github-repositories.aspx[hacking around], it can also be made to work with non-github repositories.

If using Mac, you might also want to check out Atlassian's http://www.atlassian.com/software/sourcetree/overview[Sourcetree].



[[_dg_building-isis_git_installation_cloning-the-apache-isis-repo]]
==== Cloning the Apache Isis repo

First, clone the Apache Isis repo.

If you are a *committer*, then clone from the Apache read/write repo:

[source,bash]
----
git clone https://git-wip-us.apache.org/repos/asf/isis.git
----


If you are *not a committer*, please see the xref:dg.adoc#_dg_contributing[contributing] page for details on which repo to clone from.


[[_dg_building-isis_git_installation_configuring-git]]
==== Configuring Git

Next up is to configure your user name and password; see also https://git-wip-us.apache.org/[Apache's git] docs:

[source,bash]
----
git config user.name "<i>My Name Here</i>"
git config user.email <i>myusername@apache.org</i>
----

Next, configure the `core.autocrlf` so that line endings are normalized to LF (Unix style) in the rep; again see https://git-wip-us.apache.org/[Apache's git] page:


* on Windows, use: +
+
[source,bash]
----
git config core.autocrlf true
----

* on Mac/Linux, use: +
+
[source,bash]
----
git config core.autocrlf input
----


The Windows setting means that files are converted back to CRLF on checkout; the Mac/Linux setting means that the file is left as LF on checkout.

We also recommend setting `core.safecrlf`, which aims to ensure that any line ending conversion is repeatable. Do this on all platforms:

[source,bash]
----
git config core.safecrlf true
----


Note that these settings are supplemented in the repo by the `.gitattributes` file and that explicitly specifies line handling treatment for most of the common file types that we have.

Next, we recommend you setup this a refspec so that you can distinguish remote tags from local ones. To do that, locate the `[remote &quot;origin&quot;]` section in your `.git/config` and add the third entry shown below:


[source,bash]
----
[remote "origin"]
    url = ... whatever ...
    fetch = ... whatever ...
    fetch = +refs/tags/*:refs/tags/origin/*
----


This will ensure that a `git fetch` or `git pull` places any remote tags under `origin/xxx.  For example, the`isis-1.0.0`tag on the origin will appear under`origin/isis-1.0.0`.


If you don't use git outside of Apache, you can add the `--global` flag so that the above settings apply for all repos managed by git on your PC.



[[_dg_building-isis_git_getting-help]]
=== Getting help

Three commands of git that in particular worth knowing:

* `git help _command_` +
+
will open the man page in your web browser

* `git gui` +
+
will open up a basic GUI client to staging changes and making commits.

* `gitk --all` +
+
will open the commit history for all branches. In particular, you should be able to see the local `master`, which branch you are working on (the `HEAD`), and also the last known position of the `master` branch from the central repo, called `origin/master`.

You might also want to explore using a freely available equivalent such as link:https://www.sourcetreeapp.com/[Atlassian SourceTree].

For further reading, see:

* http://www.kernel.org/pub/software/scm/git/docs/git-config.html[git config man page]
* http://www.kernel.org/pub/software/scm/git/docs/gitattributes.html[.gitattributes man page]
* http://git-scm.com/docs/gitattributes[.gitattributes git-scm.com docs]


[[_dg_building-isis_installing-java]]
== Installing Java

Apache Isis is compatible with Java 7 and Java 8.  For every-day use, the framework is usually compiled against Java 8.

Releases however are xref:_cgcom_cutting-a-release[cut] using Java 7, leveraging the link:http://maven.apache.org/plugins/maven-toolchains-plugin/[Maven toolchains plugin]).

Therefore install either/both of Java 7 JDK and Java 8 JDK.  Note that the JRE is _not_ sufficient.

[TIP]
====
If you intend to contribute back patches to Apache Isis, note that while you can develop using Java 8 within your IDE,
be sure not to use any Java 8 APIs.
====

[[_dg_building-isis_configure-maven-toolchains-plugin]]
=== Configure Maven toolchains plugin

If you are a committer that will be performing releases of Apache Isis, then you _must_ configure the
link:http://maven.apache.org/plugins/maven-toolchains-plugin/[toolchains] plugin so that releases can be built using
Java 7.

This is done by placing the `toolchains.xml` file in `~/.m2` directory.  Use the following file as a template,
adjusting paths for your platform:

[source,xml]
----
<?xml version="1.0" encoding="UTF8"?>
<toolchains>
    <toolchain>
        <type>jdk</type>
        <provides>
            <version>1.8</version>
            <vendor>oracle</vendor>
        </provides>
        <configuration>
            <jdkHome>/usr/lib64/jvm/jdk1.8.0_65</jdkHome>
            <!--
            <jdkHome>c:\Program Files\Java\jdk1.8.0_65</jdkHome>
            -->
        </configuration>
    </toolchain>
    <toolchain>
        <type>jdk</type>
        <provides>
            <version>1.7</version>   <!--1-->
            <vendor>oracle</vendor>
        </provides>
        <configuration>
            <jdkHome>/usr/lib64/jvm/jdk1.7.0_79</jdkHome>
            <!--
            <jdkHome>c:\Program Files\Java\jdk1.7.0_79</jdkHome>
            -->
        </configuration>
    </toolchain>
</toolchains>
----
<1> The Apache Isis build is configured to search for the (`1.7, oracle`) JDK toolchain.

The Apache Isis parent `pom.xml` activates this plugin whenever the `apache-release` profile is enabled.




[[_dg_building-isis_installing-maven]]
== Installing Maven

Install Maven 3.0.x, downloadable http://maven.apache.org/download.html[here].

Set `MAVEN_OPTS` environment variable:

[source,bash]
----
export MAVEN_OPTS="-Xms512m -Xmx1024m"
----


[NOTE]
====
Previously we suggested `-XX:MaxPermSize=256m`, but this option has been removed in Java 8.  (As of 1.9.0, Apache Isis is built using Java 8 but with source and target set to JDK 1.7).
====


[[_dg_building-isis_building-all-of-apache-isis]]
== Building all of Apache Isis

To build the source code from the command line, simply go to the root directory and type:

[source,bash]
----
mvn clean install
----


The first time you do this, you'll find it takes a while since Maven needs to download all of the Apache Isis prerequisites.

Thereafter you can speed up the build by adding the `-o` (offline flag).  To save more time still, we also recommend that you build in parallel.  (Per this link:http://zeroturnaround.com/rebellabs/your-maven-build-is-slow-speed-it-up/[blog post]), you could also experiment with a number of JDK parameters that we've found also speed up Maven:

[source,bash]
----
export MAVEN_OPTS="-Xms512m -Xmx1024m -XX:+TieredCompilation -XX:TieredStopAtLevel=1"
mvn clean install -o -T1C
----

For the most part, though, you may want to rely on an IDE such as Eclipse to build the codebase for you. Both Eclipse and Idea (12.0+) support incremental background compilation.

When using Eclipse, a Maven profile is configured such that Eclipse compiles to `target-ide` directory rather than the usual `target` directory. You can therefore switch between Eclipse and Maven command line without one interfering with the other.



[[_dg_building-isis_checking-for-vulnerabilities]]
== Checking for Vulnerabilities

Apache Isis configures the link:https://www.owasp.org/index.php/Main_Page[OWASP] link:https://www.owasp.org/index.php/OWASP_Dependency_Check[dependency check] link:http://jeremylong.github.io/DependencyCheck/dependency-check-maven/index.html[Maven plugin] to determine whether the framework uses libraries that are known to have security vulnerabilities.

To check, run:

[source,bash]
----
mvn org.owasp:dependency-check-maven:aggregate -Dowasp
----

This will generate a single report under `target/dependency-check-report.html`.


[NOTE]
====
The first time this runs can take 10~20 minutes to download the NVD data feeds.
====

To disable, either run in offline mode (add `-o` or `--offline`) or omit the `owasp` property.



[[_dg_building-isis_checking-for-use-of-internal-jdk-apis]]
== Checking for use of internal JDK APIs

Apache Isis configures the link:https://maven.apache.org/plugins-archives/maven-jdeps-plugin-3.0.0/[jdeps maven plugin] to check for any usage of internal JDK APIs.  This is in preparation for Java 9 module system (Jigsaw) which will prevent such usage of APIs.

To check, run:

[source,bash]
----
mvn clean install -Djdeps
----

This will fail the build on any module that currently uses an internal JDK API.


[WARNING]
====
At the time of writing the `isis-core-schema` module fails the build.
====


